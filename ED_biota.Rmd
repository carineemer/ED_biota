---
title: "Defaunation effects on the evolution of plant species"
author: "Carine Emer"
date: "04/09/2019"
output: html_document
---
Projeto Parcelas/Biota
ED of plants in open and closed plots

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load packages}
library(picante)
library(phytools)
library(ape)
library(caper)
library(plyr)
library(reshape)
library(reshape2)
library(data.table)
library(dplyr)
library(bipartite)
library(Matrix)
library(lme4)
library(tibble)
library(phangorn)
library(plotly)
```

```{r input data}
setwd("~/Dropbox/BIOTA/Evol_distinct/ED_biota")
load("~/Dropbox/BIOTA/Evol_distinct/ED_biota/ms_biota.RData")

CAR_com<-read.table("CARcomm.txt", row.names=1, h=T)
ITA_com<-read.table("ITAcomm.txt", row.names=1, h=T)
CBO_com<-read.table("CBOcomm.txt", row.names=1, h=T)
VG_com<-read.table("VGcomm.txt", row.names=1, h=T)

#communities<-read.csv("data_communities nat.csv")
#plants_taxon<-read.csv("plants_list_taxonomy_regional_pool.csv")

save.image("ms_biota.RData")

```


```{r building tree plants, include= =FALSE}

########## PLANTS 
phylo<-read.tree("PhytoPhylo.tre") # read in the megaphylogeny, obtained when downloading Phylomaker
nodes<-read.csv("nodes.csv",header=T, sep="\t") # read in the nodes information of the megaphylogeny.
source("S.PhyloMaker")
#plants_taxon<-read.csv("plants_list_taxonomy_regional_pool.csv")
#plants_taxon<-read.csv("plants_list_taxonomy.csv")
#result_plants<-S.PhyloMaker(splist=plants_taxon, tree=phylo, nodes=nodes) # run the function S.PhyloMaker.

#par(mfrow=c(1,3),mar=c(0,0,1,0)) # show the phylogenies of the three scenarios.
#plot(result_plants$Scenario.1,cex=1.1,main="Scenario One") ## we chose to work with scenario 1 that "assigns"add genera or species as basal polytomies within their families of genera" 
#plot(result$Scenario.2,cex=1.1,main="Scenario Two")
#plot(result$Scenario.3,cex=1.1,main="Scenario Three")
#is.binary.tree(result_plants$Scenario.1)

#write.nexus(result$Scenario.1,file="tree_phylomaker_1.nex") ### saving nexus format
#write.tree(result$Scenario.1,file="tree_phylomaker_1.nwk") ### saving newick format

#mytree<-result_plants$Scenario.1

########## using the saved newick format of the chosen scenario to plot the tree, or read the correspondent vector created above (mytree)
#tree_plants<-read.tree("tree_phylomaker_1.nwk")
#tree_plants<-mytree
#plot(tree_plants, cex=0.1) 
#zoom(tree_plants,240:280,show.node.label=TRUE)
#axisPhylo(tree_nplants)
#branching.times(tree_plants)

#library(ape)
#source("PolytomyResolver.R") #### function in the PolytomyResolver.R sent by Miguel Verdu

#tree_plants<-read.tree("tree_phylomaker_1.nwk") ### read the tree resolved in PhyloMaker, or use the vector created above

#PolytomyResolver(tree_plants,file="tree_plants") ### tree_plants.xml goes to BEAST - takes a few hours

### then, generates tree_plants.trees which should be read again here to run the following:

#trees<-read.nexus("tree_plants.trees") ## huge file


######### after BEAST

#postburnin<-trees[(0.25*length(trees)):length(trees)] #drops 25% of trees as burning 
 
#tt100<-sample(postburnin, size=100) #randomly selects 100 trees
#write.tree(tt100[[1]])
#plot(tt100,show.tip.label=FALSE)
#is.binary(tt100[[1]])

#tt100_1<-tt100[[1]]
#plot(tt100_1)
#write.tree(tt100,"plants_100trees.nwk")

```


